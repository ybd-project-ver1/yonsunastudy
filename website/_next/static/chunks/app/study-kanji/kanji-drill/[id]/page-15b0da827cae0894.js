(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[446],{61:function(e,t,s){Promise.resolve().then(s.bind(s,1467)),Promise.resolve().then(s.bind(s,707))},6648:function(e,t,s){"use strict";s.d(t,{default:function(){return n.a}});var i=s(5601),n=s.n(i)},5601:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var s in t)Object.defineProperty(e,s,{enumerable:!0,get:t[s]})}(t,{default:function(){return h},getImageProps:function(){return a}});let i=s(9920),n=s(497),l=s(8173),r=i._(s(1241));function a(e){let{props:t}=(0,n.getImgProps)(e,{defaultLoader:r.default,imgConf:{deviceSizes:[640,750,828,1080,1200,1920,2048,3840],imageSizes:[16,32,48,64,96,128,256,384],path:"/_next/image/",loader:"default",dangerouslyAllowSVG:!1,unoptimized:!0}});for(let[e,s]of Object.entries(t))void 0===s&&delete t[e];return{props:t}}let h=l.Image},291:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"RouterContext",{enumerable:!0,get:function(){return i}});let i=s(9920)._(s(2265)).default.createContext(null)},707:function(e,t,s){"use strict";s.d(t,{default:function(){return w}});var i=s(7437),n=s(2265),l=s(4587),r=s(9733),a=s(9888),h=s(4662),o=s(5642),d=s(259),c=s(8185),u=s(9973),g=s(9366);class p{mouseDown(e){this.context.lineWidth=this.lineWidth,this.handwritingX=[],this.handwritingY=[],this.drawing=!0,this.context.beginPath();let t=this.canvas.getBoundingClientRect(),s=e.clientX-t.left,i=e.clientY-t.top;this.context.moveTo(s,i),this.handwritingX.push(s),this.handwritingY.push(i)}mouseMove(e){if(this.drawing){let t=this.canvas.getBoundingClientRect(),s=e.clientX-t.left,i=e.clientY-t.top;this.context.lineTo(s,i),this.context.stroke(),this.handwritingX.push(s),this.handwritingY.push(i)}}mouseUp(){let e=[];e.push(this.handwritingX),e.push(this.handwritingY),e.push([]),this.trace.push(e),this.drawing=!1,this.allowUndo&&this.step.push([this.canvas.toDataURL()])}touchStart(e){e.preventDefault(),this.context.lineWidth=this.lineWidth,this.handwritingX=[],this.handwritingY=[];let t=document.documentElement,s=this.canvas.getBoundingClientRect(),i=s.top+window.scrollY-t.clientTop,n=s.left+window.scrollX-t.clientLeft,l=e.changedTouches[0],r=l.pageX-n,a=l.pageY-i;this.handwritingX.push(r),this.handwritingY.push(a),this.context.beginPath(),this.context.moveTo(r,a)}touchMove(e){e.preventDefault();let t=document.documentElement,s=e.targetTouches[0],i=this.canvas.getBoundingClientRect(),n=i.top+window.scrollY-t.clientTop,l=i.left+window.scrollX-t.clientLeft,r=s.pageX-l,a=s.pageY-n;this.handwritingX.push(r),this.handwritingY.push(a),this.context.lineTo(r,a),this.context.stroke()}touchEnd(){let e=[];e.push(this.handwritingX),e.push(this.handwritingY),e.push([]),this.trace.push(e),this.allowUndo&&this.step.push([this.canvas.toDataURL()])}loadFromUrl(e,t){let s=new Image;s.onload=()=>{t.context.clearRect(0,0,this.width,this.height),t.context.drawImage(s,0,0)},s.src=e}setUndoRedo(e,t){this.allowUndo=e,this.allowRedo=!!e&&t,this.allowUndo||(this.step=[],this.redoStep=[],this.redoTrace=[])}setLineWidth(e){this.lineWidth=e}setCallback(e){this.callback=e}setOptions(e){this.options=e}undo(){this.allowUndo&&!(this.step.length<=0)&&(this.allowUndo&&1===this.step.length?(this.redoStep.push(this.step.pop()||[]),this.redoTrace.push(this.trace.pop()||[]),this.context.clearRect(0,0,this.width,this.height)):(this.allowRedo?(this.redoStep.push(this.step.pop()||[]),this.redoTrace.push(this.trace.pop()||[])):(this.step.pop(),this.trace.pop()),this.loadFromUrl(this.step.slice(-1)[0],this)))}redo(){this.allowRedo&&!(this.redoStep.length<=0)&&(this.step.push(this.redoStep.pop()||[]),this.trace.push(this.redoTrace.pop()||[]),this.loadFromUrl(this.step.slice(-1)[0],this))}clear(){this.context.clearRect(0,0,this.width,this.height),this.step=[],this.redoStep=[],this.redoTrace=[],this.trace=[]}recognize(){let e=this.trace,t=this.options||{},s=this.callback||(()=>{});fetch("https://www.google.com.tw/inputtools/request?ime=handwriting&app=mobilesearch&cs=1&oe=UTF-8",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({options:"enable_pre_space",requests:[{writing_guide:{writing_area_width:t.width||this.width||void 0,writing_area_height:t.height||this.width||void 0},ink:e,language:t.language||"zh_TW"}]})}).then(async e=>{let t=await e.json();if(200===e.status){let e=[];if(1===t.length){s(void 0,Error(t[0]));return}e=t[1][0][1],this.options.numOfWords&&(e=e.filter(e=>e.length===this.options.numOfWords)),this.options.numOfReturn&&(e=e.slice(0,this.options.numOfReturn)),s(e,void 0)}else 400===e.status?s(void 0,Error("Access denied")):503===e.status?s(void 0,Error("Can't connect to recognition server")):s(void 0,Error("Recognition server error"))}).catch(e=>{console.error("Request Error:",e)})}getCurrentImageUrl(){return this.canvas.toDataURL()}constructor(e,t=3){let s=e&&e.getContext("2d");if(!e||!s)throw Error("Canvas要素が指定されていないか、コンテキストを取得できませんでした。");this.canvas=e,this.context=s,this.context.lineCap="round",this.context.lineJoin="round",this.lineWidth=t||3,this.width=e.offsetWidth,this.height=e.offsetHeight,this.drawing=!1,this.handwritingX=[],this.handwritingY=[],this.trace=[],this.options={},this.step=[],this.redoStep=[],this.redoTrace=[],this.allowUndo=!1,this.allowRedo=!1,this.callback=void 0,e.addEventListener("mousedown",this.mouseDown.bind(this)),e.addEventListener("mousemove",this.mouseMove.bind(this)),e.addEventListener("mouseup",this.mouseUp.bind(this)),e.addEventListener("touchstart",this.touchStart.bind(this)),e.addEventListener("touchmove",this.touchMove.bind(this)),e.addEventListener("touchend",this.touchEnd.bind(this)),e.width=this.width,e.height=this.height}}var x=s(6648);let m="ml-2 bg-sky-600 text-white rounded-full px-[8px] text-[16px]";function f(e,t){if(!t)return"";let s=t.getContext("2d");return s?(s.fillStyle="white",s.fillRect(0,0,t.width,t.height),s.font=(e.length>=4?"72px":"96px")+" Arial",s.fillStyle="black",s.textAlign="center",s.textBaseline="middle",s.fillText(e,t.width/2,t.height/2),t.toDataURL("image/png")):""}function w(e){let{kanji:t}=e,s=(0,n.useRef)(null),w=(0,n.useRef)(null),[b,j]=(0,n.useState)(!1),[v,N]=(0,n.useState)(),[C,U]=(0,n.useState)(0),[k,R]=(0,n.useState)(!1),[S,y]=(0,n.useState)([]),[E,_]=(0,n.useState)(null),[T,Y]=(0,n.useState)([]),z=t.problems[C],O=()=>{null==v||v.clear(),y([]),_(null)},L=()=>{U(C+1),O(),null==v||v.clear()},X=()=>{let e=s.current||document.getElementById("canvas");if(!e)return;let t=new p(e);t.setCallback((e,t)=>{if(t)throw t;if(!e){y(["入力された文字を認識できませんでした。"]);return}y(e),_(e[0])}),t.setLineWidth(window.outerWidth>500?5:3),t.setOptions({language:"ja-JP",numOfReturn:3,width:e.offsetWidth,height:e.offsetHeight}),j(!0),N(t)};if((0,n.useEffect)(()=>{k||(document.title="漢字ドリル「".concat(t.id,"」 - By YBD Project"),X())},[k,t.id]),k){let e=T.slice(0,t.problems.length).filter((e,s)=>e.answer===t.problems[s].answer).filter(e=>e).length;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(l.Z,{className:"bg-teal-600/20 p-[2px] rounded mb-6",trailSize:"lg",trailColor:"teal",duration:"7s",children:(0,i.jsxs)("h2",{className:"text-xl font-semibold py-2 px-4",children:["ー ドリル「",t.id,"」の結果 ー"]})}),(0,i.jsxs)(g.Z,{className:"mb-4",children:["結果：",10*e,"点/",10*t.problems.length,"点"]}),(0,i.jsx)(d.Z,{className:"mb-4",children:T.map((e,s)=>(function(e,t,s,n){let l=e.answer===s.problems[t].answer,r=l?"emerald-600":"rose-600";return(0,i.jsxs)(o.d$,{children:[(0,i.jsx)("div",{className:"mt-2",children:(0,i.jsx)(c.Zb,{className:"rounded-lg border-2 border-"+r,children:(0,i.jsxs)(c.aY,{className:"flex flex-col gap-2 aspect-square items-center justify-around p-6 select-none",children:[(0,i.jsxs)("p",{className:"text-xl font-bold text-"+r,children:["ー ",l?"正解":"不正解"," ー"]}),(0,i.jsxs)("div",{className:"flex flex-col gap-2 w-full border border-slate-400 rounded-lg p-4",children:[(0,i.jsxs)(g.Z,{children:["問題",(0,i.jsx)("span",{className:m,children:t+1})]}),(0,i.jsx)("p",{children:s.problems[t].problem})]}),(0,i.jsxs)("div",{className:"flex flex-col gap-2 w-full border rounded-lg p-4 border-slate-400",children:[(0,i.jsxs)(g.Z,{children:["解答",(0,i.jsx)("span",{className:m,children:t+1})]}),(0,i.jsxs)("p",{className:"font-semibold text-"+r,children:["あなたの解答：",e.answer]})]}),e.imageUrl&&(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)("div",{className:"flex flex-col gap-2 w-full border rounded-lg p-4 border-slate-400",children:[(0,i.jsx)(g.Z,{children:"あなたが書いた漢字"}),(0,i.jsx)(x.default,{src:e.imageUrl,alt:e.answer,width:300,height:150})]})}),(0,i.jsxs)("div",{className:"flex flex-col gap-2 w-full border rounded-lg p-4 border-slate-400",children:[(0,i.jsx)(g.Z,{children:"正解の漢字"}),(0,i.jsx)(x.default,{src:f(s.problems[t].answer,n),alt:e.answer,width:300,height:150})]})]})})}),(0,i.jsx)("div",{className:"hidden text-emerald-600 border-emerald-600 "}),(0,i.jsx)("div",{className:"hidden text-rose-600 border-rose-600 "})]},t)})(e,s,t,w.current))}),(0,i.jsx)("p",{className:"text-center w-11/12 mb-6",children:"※ カードを横にスライドすることで、その他の回答を確認できます"}),(0,i.jsx)(r.z,{onClick:()=>{U(0),Y([]),O(),R(!1)},className:"bg-emerald-700 hover:bg-emerald-800",children:"もう一度勉強する"})]})}return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",{className:"w-11/12 bg-white p-6 rounded-lg border-2 border-slate-600 mb-4",children:(0,i.jsxs)("div",{className:"mx-auto w-max",children:[(0,i.jsxs)("h2",{className:"text-lg font-bold mb-4",children:["問題",(0,i.jsx)("span",{className:m,children:C+1})]}),(0,i.jsx)("p",{className:"text-xl text-center",children:z.problem})]})}),(0,i.jsxs)("div",{className:"w-11/12 bg-white p-6 rounded-lg border-2 border-slate-600 mb-6",children:[(0,i.jsxs)("h2",{className:"text-lg font-bold mb-4",children:["解答欄",(0,i.jsx)("span",{className:m,children:C+1})]}),(0,i.jsxs)("div",{className:"relative",children:[!b&&(0,i.jsx)(g.Z,{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2",children:"現在、手書き入力を準備中です。"}),(0,i.jsxs)("div",{className:b?"":"invisible",children:[(0,i.jsx)("canvas",{ref:s,id:"canvas",className:"w-full h-full block border border-slate-400 rounded-lg"},"canvas"),(0,i.jsxs)("div",{className:"mt-4 flex gap-4 justify-end",children:[(0,i.jsx)(r.z,{onClick:O,variant:"outline",children:"消去"}),(0,i.jsx)(r.z,{onClick:()=>null==v?void 0:v.recognize(),className:"bg-sky-700 px-6 hover:bg-sky-800",children:"判定"})]}),0!==S.length&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(u.Separator,{className:"my-4"}),(0,i.jsxs)(g.Z,{className:"mb-2",children:["現在の回答：",E||S[0]]}),(0,i.jsxs)(a.Ph,{defaultValue:S[0],onValueChange:e=>_(e),children:[(0,i.jsx)(a.i4,{className:"w-1/2",children:(0,i.jsx)(a.ki,{placeholder:S[0]})}),(0,i.jsx)(a.Bw,{children:(0,i.jsx)(a.DI,{children:S.map((e,t)=>(0,i.jsx)(a.Ql,{value:e,children:e},t))})})]})]})]})]})]}),(0,i.jsx)("div",{className:"w-11/12",children:(0,i.jsx)("div",{className:"flex justify-between",children:C===t.problems.length-1?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(h.Vq,{children:[(0,i.jsx)(h.hg,{asChild:!0,children:(0,i.jsx)(r.z,{className:"bg-rose-700 hover:bg-rose-800",children:"解答しない"})}),(0,i.jsxs)(h.cZ,{children:[(0,i.jsx)(h.fK,{children:(0,i.jsxs)(h.$N,{className:"text-xl font-bold",children:["「",z.answer,"」の書き方"]})}),(0,i.jsx)(x.default,{className:"mx-auto",src:f(z.answer,w.current),alt:"image",width:300,height:150}),(0,i.jsx)(h.cN,{children:(0,i.jsx)(h.GG,{asChild:!0,children:(0,i.jsx)(r.z,{onClick:()=>{Y(e=>[...e,{answer:"未解答",imageUrl:""}]),R(!0)},type:"button",children:"分かりました"})})})]})]}),(0,i.jsx)(r.z,{disabled:!E,onClick:()=>{E&&(Y(e=>[...e,{answer:E,imageUrl:(null==v?void 0:v.getCurrentImageUrl())||""}]),R(!0))},className:"bg-teal-700 hover:bg-teal-800",children:"結果を見る"})]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(h.Vq,{children:[(0,i.jsx)(h.hg,{asChild:!0,children:(0,i.jsx)(r.z,{className:"bg-rose-700 hover:bg-rose-800",children:"解答しない"})}),(0,i.jsxs)(h.cZ,{children:[(0,i.jsx)(h.fK,{children:(0,i.jsx)(h.$N,{className:"text-xl font-bold",children:"この問題の正解"})}),(0,i.jsx)(x.default,{className:"mx-auto",src:f(z.answer,w.current),alt:"image",width:300,height:150}),(0,i.jsx)(h.cN,{children:(0,i.jsx)(h.GG,{asChild:!0,children:(0,i.jsx)(r.z,{onClick:()=>{Y(e=>[...e,{answer:"未解答",imageUrl:""}]),setTimeout(L,150)},type:"button",children:"分かりました"})})})]})]}),(0,i.jsx)(r.z,{disabled:!E,onClick:()=>{E&&(Y(e=>[...e,{answer:E,imageUrl:(null==v?void 0:v.getCurrentImageUrl())||""}]),L())},className:"bg-teal-700 hover:bg-teal-800",children:"次の問題に進む"})]})})}),(0,i.jsx)("canvas",{id:"textCanvas",ref:w,width:300,height:150,className:"hidden"})]})}}},function(e){e.O(0,[868,714,294,268,360,387,873,971,23,744],function(){return e(e.s=61)}),_N_E=e.O()}]);